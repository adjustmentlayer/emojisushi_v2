description = "Default"

[cart]
showDiscountApplier = 1
showTaxes = 1

[mallDependencies]

[session]
security = "all"

[staticPage]
useContent = 1
default = 0

[currencyPicker]

[localePicker]
forceUrl = 1

[enhancedEcommerceAnalytics]

==

use Symfony\Component\HttpFoundation\Session\Session;
use Carbon\Carbon;
use Lovata\BaseCode\Models\Branches;
function onStart() {
    $session = new Session();
    $spots = Branches::all();



    if (!$session->has('activeSpotId')) {
        $session->set('activeSpotId', $spots[0]['id']);
    }

    $exist = 0;
    if (isset($_POST['spot'])) {

        foreach ($spots as $s) {
            if ($_POST['spot'] == $s['id']) {
                $exist++;
            }
        }

        if ($exist) {
            $session->set('activeSpotId', $_POST['spot']);

        }
    }
    $session->set('spots', $spots);

    foreach ($spots as $s) {
        if ($session->get('activeSpotId') == $s['id']) {
            $this->page['activeSpotName'] = $s['name'];
            $this->page['phones'] = explode(',',$s['phones']);
            $session->set('activeChatId', $s['chat_id']);
        }
    }



    $this->page['activeSpotId'] = $session->get('activeSpotId');
    $this->page['spots'] = $session->get('spots');

    $this->page['query'] = input('q');

    $start = explode(':','10:00');
    $finish = explode(':','22:30');

    $dt = Carbon::now()->timezone('Europe/Kiev');;
    $hour = $dt->hour;
    $minute = $dt->minute;


    $closed =
    ($hour < $start[0]  || ($start[0] == $hour && $minute < $start[1])) ||
    ($hour > $finish[0] || ($finish[0] == $hour && $minute > $finish[1] ));


    $this->page['shop_is_closed'] = $closed;
}


==
<!doctype html>
<html lang="en" class="dark">
<head>
    {% partial 'head' %}
    {% styles %}
    {% component 'enhancedEcommerceAnalytics' %}
    {% component 'mallDependencies' %}

</head>
<body class="min-h-screen flex flex-col justify-between bg-secondary text-black dark:bg-black dark:text-white drawer drawer--right relative">
{% partial 'header'  %}
{% partial 'navigation' %}

<main class="flex-grow max-w-6xl w-full mx-auto py-8">
    {% page %}
</main>

{% partial 'footer' %}

{% partial 'cartmodal' %}

{% partial 'spinner' %}

{% partial 'spotmodal' %}

<script src="{{ 'assets/app.js' | theme }}"></script>

{% framework extras %}
{% scripts %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous"></script>
<script src="{{ 'assets/js/spotDropdown.js' | theme }}"></script>
<script src="{{ 'assets/js/workingHoursChecker.js' | theme }}"></script>
<script src="{{ 'assets/js/scripts1.js' | theme }}"></script>
<script src="{{ 'assets/js/cart.js' | theme }}"></script>



{% if this.page.shop_is_closed %}
    <script>
        Swal.fire({
            title: 'Ресторан закрыт!',
            text: 'Заказы принимаются с 10:00 до 22:30',
            icon: 'warning',
            confirmButtonText: 'Ок'
        })
    </script>
{% endif %}


{% flash %}
    <script>
        $(function() {
            $.oc.flashMsg({type: '{{ type }}', text: '{{ message }}'})
        })
    </script>
{% endflash %}
</body>
</html>
